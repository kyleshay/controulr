/*
 Controller v1.0.0
 (c) 2014 Kyle Shay. http://kyleshay.info
 License: MIT
*/
var Controller=Controller||{};Controller=function(element,o){var controls=[];function HandleTouch(e){e.preventDefault();var controller=e.target;if(e.target==element)return;controls[controller.getAttribute('id')].handle(e)};function createGrid(row,column){var ratioW=Math.floor((window.innerWidth||document.documentElement.offsetWidth)/column),ratioH=Math.floor((window.innerHeight||document.documentElement.offsetHeight)/row);var parent=document.getElementById('grid-parent');if(!parent){parent=document.createElement('div');parent.id='grid-parent';parent.className='grid';parent.style.width=(ratioW*column)+'px';parent.style.height=(ratioH*row)+'px'}parent.innerHTML="";for(var r=0;r<row;r++){for(var c=0;c<column;c++){parent.innerHTML+="<div style='"+"width:"+(ratioW-1)+"px;"+"height:"+(ratioH-1)+"px"+"'></div>"}}document.body.appendChild(parent);return{w:Math.floor((window.innerWidth||document.documentElement.offsetWidth)/column),h:Math.floor((window.innerHeight||document.documentElement.offsetHeight)/row)}}var grid=createGrid(20,30);if(o.supportmouse){element.addEventListener("mousemove",HandleTouch);element.addEventListener("mouseup",HandleTouch);element.addEventListener("mousedown",HandleTouch)}element.addEventListener("touchstart",HandleTouch);element.addEventListener("touchmove",HandleTouch);element.addEventListener("touchend",HandleTouch);this.add=function(control){controls[control.element().getAttribute('id')]=control;var c=control.element();c.style.position='absolute',c.style.left=grid.w*control.position().left,c.style.top=grid.h*control.position().top,c.style.width=grid.w*control.size().width-1,c.style.height=grid.h*control.size().height-1;element.appendChild(c)}};var Controller=Controller||{};Controller.Touchpad=function(o){var element,size,position,start,end,move;if(o.start)start=o.start;if(o.end)end=o.end;if(o.move)move=o.move;position=o.position||{top:0,left:0};size=o.size||{width:2,height:2};element=document.createElement('div');element.id="touchpad";if(o.style)element.style.cssText=o.style;var s=d=p={x:0,y:0};this.handle=function(e){switch(e.type){case'mousedown':case'touchstart':d={x:0,y:0};s={x:e.x||e.changedTouches[0].clientX,y:e.y||e.changedTouches[0].clientY};start();break;case'mousemove':case'touchmove':d.x=s.x-e.x||e.changedTouches[0].clientX;d.y=s.y-e.y||e.changedTouches[0].clientY;move();break;case'mouseup':case'touchend':p.x-=d.x;p.y-=d.x;end();break}};this.touch=function(){return{x:p.x-d.x,y:p.x-d.y}};this.element=function(){return element};this.position=function(){return position};this.size=function(){return size}};var Controller=Controller||{};Controller.Button=function(o){var element,size,position,start,end,buttons;if(o.start)start=o.start;if(o.end)end=o.end;if(o.buttons)buttons=o.buttons;position=o.position||{top:0,left:0};size=o.size||{width:1,height:1};element=document.createElement('div');element.id="button"+o.text;element.style.borderRadius="100";element.style.boxShadow="1px 1px 1px #222";element.style.textAlign="center";element.style.backgroundColor=o.color||"";element.innerText=o.text||'x';this.handle=function(e){switch(e.type){case'mousedown':case'touchstart':e.target.className='active';start(e);break;case'mouseup':case'touchend':e.target.className='';end(e);break}};this.element=function(){return element};this.position=function(){return position};this.size=function(){return size}};var Controller=Controller||{};Controller.Gesture=function(o){var element,start,end,move;if(o.start)start=o.start;if(o.end)end=o.end;if(o.move)move=o.move;element=document.createElement('div');element.id="touchpad";if(o.style)element.style=o.style;var s=d=p={x:0,y:0};this.handle=function(e){switch(e.type){case'touchstart':d={x:0,y:0};s={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY};start();break;case'touchmove':d.x=s.x-e.changedTouches[0].clientX;d.y=s.y-e.changedTouches[0].clientY;move();break;case'touchend':p.x-=d.x;p.y-=d.x;end();break}};this.position=function(){return{x:p.x-d.x,y:p.x-d.y}};this.element=function(){return element}};var Controller=Controller||{};Controller.Joystick=function(o){var element,start,end,move;if(o.start)start=o.start;if(o.end)end=o.end;if(o.move)move=o.move;element=document.createElement('div');element.id="button";if(o.style)element.style=o.style;var s=d=p={x:0,y:0};this.handle=function(e){switch(e.type){case'touchstart':d={x:0,y:0};s={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY};start();break;case'touchmove':d.x=s.x-e.changedTouches[0].clientX;d.y=s.y-e.changedTouches[0].clientY;move();break;case'touchend':p.x-=d.x;p.y-=d.x;end();break}};this.direction=function(){return'up'};this.element=function(){return element}}
