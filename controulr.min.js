/*
 Controller v1.0.1
 (c) 2014 Kyle Shay. http://kyleshay.info
 License: MIT
*/
var Controller=Controller||{};Controller=function(e,t){function r(t){if(t.target==e)return;if(t.type.indexOf("key")==-1){t.preventDefault();n[t.target.getAttribute("id")].handle(t)}else{for(var r in n){if(n[r].element().keyBind==t.keyCode){t.type="mouse"+t.type.substring(3);t.keytarget=n[r].element();n[r].handle(t);break}}}}function i(e,t){var n=Math.floor((window.innerWidth||document.documentElement.offsetWidth)/t),r=Math.floor((window.innerHeight||document.documentElement.offsetHeight)/e);var i=document.getElementById("grid-parent");if(!i){i=document.createElement("div");i.id="grid-parent";i.className="grid"}i.style.height=r*e+"px";i.style.width=n*t+"px";i.innerHTML="";for(var s=0;s<e;s++){for(var o=0;o<t;o++){i.innerHTML+="<div style='"+"width:"+(n-1)+"px;"+"height:"+(r-1)+"px"+"'></div>"}}document.body.appendChild(i);return{w:Math.floor((window.innerWidth||document.documentElement.offsetWidth)/t),h:Math.floor((window.innerHeight||document.documentElement.offsetHeight)/e)}}function a(e,t,n){var r=t.element();r.style.position="absolute";r.style.left=e.w*t.position().left;r.style.top=e.h*t.position().top;r.style.width=e.w*t.size().width-1;r.style.height=e.h*t.size().height-1;if(n){r.style.left=e.w*t.position().top;r.style.top=e.h*t.position().left}return r}var n=[];var s=i(t.row||15,t.column||10);var o="onorientationchange"in window,u=o?"orientationchange":"resize";window.addEventListener(u,function(){if(window.orientation||window.innerWidth<350)s=i(t.column||15,t.row||10);else s=i(t.row||15,t.column||10);for(var e in n){a(s,n[e],window.innerWidth<350)}},false);if(t.supportmouse){e.addEventListener("mousemove",r);e.addEventListener("mouseup",r);e.addEventListener("mousedown",r)}document.body.addEventListener("keydown",r);document.body.addEventListener("keyup",r);e.addEventListener("touchstart",r);e.addEventListener("touchmove",r);e.addEventListener("touchend",r);this.add=function(t){n[t.element().getAttribute("id")]=t;e.appendChild(a(s,t))}};var Controller=Controller||{};Controller.Button=function(e){var t,n,r,i,s,o;if(e.start)i=e.start;if(e.end)s=e.end;if(e.buttons)o=e.buttons;r=e.position||{top:0,left:0};n=e.size||{width:1,height:1};t=document.createElement("div");t.id="button"+e.text;t.className="button";t.style.borderRadius=e.round?"100px":"";t.style.backgroundColor=e.color||"";t.innerText=e.text||"x";t.keyBind=(e.key||"a").toUpperCase().charCodeAt(0);this.handle=function(e){var t=e.keytarget||e.target;switch(e.type){case"keydown":case"mousedown":case"touchstart":if(t.className.indexOf("active")==-1)t.className+=" active";i(e);break;case"keyup":case"mouseup":case"touchend":t.className=t.className.replace(" active","");s(e);break}};this.element=function(){return t};this.position=function(){return r};this.size=function(){return n}};var Controller=Controller||{};Controller.Touchpad=function(e){var t,n,r,i,s,o;if(e.start)i=e.start;if(e.end)s=e.end;if(e.move)o=e.move;r=e.position||{top:0,left:0};n=e.size||{width:2,height:2};t=document.createElement("div");t.id="touchpad";if(e.style)t.style.cssText=e.style;var u=d=p={x:0,y:0};this.handle=function(e){switch(e.type){case"mousedown":case"touchstart":d={x:0,y:0};u={x:e.x||e.changedTouches[0].clientX,y:e.y||e.changedTouches[0].clientY};i();break;case"mousemove":case"touchmove":d.x=u.x-e.x||e.changedTouches[0].clientX;d.y=u.y-e.y||e.changedTouches[0].clientY;o();break;case"mouseup":case"touchend":p.x-=d.x;p.y-=d.x;s();break}};this.touch=function(){return{x:p.x-d.x,y:p.x-d.y}};this.element=function(){return t};this.position=function(){return r};this.size=function(){return n}}